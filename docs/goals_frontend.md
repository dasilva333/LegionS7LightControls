# Frontend Design Blueprint (`latest_goals_frontend_design.md`)

This document outlines the architecture and design for the Unofficial Lenovo Lighting Controller's user interface. It will be a modern, cross-platform Progressive Web App (PWA) built with **Ionic** and **Angular** (or React/Vue, as preferred).

## 1. Stack & Architecture

*   **Framework:** **Ionic Framework** with the **Tabs** starter template. This provides a professional, mobile-first UI foundation with pre-built navigation that works perfectly on desktop. Using Typescript + React.
*   **Backend Communication:** The frontend is a pure client-side application. It will communicate exclusively with the Node.js/Express backend API running on `http://localhost:3005`. All state and control commands will be sent via REST API calls.
*   **Deployment:**
    *   **Development:** Served via `ionic serve` on a local development port (e.g., `8100`), configured to proxy API requests to `localhost:3005` to avoid CORS issues.
    *   **Production:** The final application will be a static build (`www` or `dist` folder) served directly by the Express backend.

## 2. UI Layout: Tabbed Interface

The application will use a standard three-tab layout for clear separation of concerns.

### **Tab 1: Dashboard (Home)**

This is the primary "at-a-glance" view, providing real-time status of the keyboard lighting. It is a read-only view that polls the backend for updates.

*   **Title:** Dashboard
*   **Icon:** `home-outline`

**Key UI Components:**

*   **Active Profile Card:**
    *   A large, prominent card displaying the current state.
    *   **Content:**
        *   `Active Profile ID:` (e.g., `4`) - Fetched from `GET /active-profile/id`.
        *   `Animation Name:` (e.g., `Rainbow Wave`) - The ID is looked up against the data from `GET /static-data`.
        *   `Current Brightness:` (e.g., `2`) - Fetched from a new `/brightness` endpoint.
*   **Time-of-Day Status Card:**
    *   Shows the status of the ambient scheduler.
    *   **Content:**
        *   `Scheduler State:` (e.g., `ACTIVE` or `OVERRIDDEN BY PROCESS`) - Determined by server-side logic.
        *   `Current Ambient Color:` A color swatch showing the current RGB value being generated by the time-of-day gradient.
*   **Process Override Status Card:**
    *   Displays information about the highest-priority override.
    *   **Content:**
        *   `Override State:` (e.g., `INACTIVE` or `ACTIVE: Destiny2.exe`).
        *   `Active Profile:` (e.g., `aurora_sync.json`).

### **Tab 2: Settings**

This tab allows for full configuration of the automation layers. It will use sub-pages or expandable sections for each category.

*   **Title:** Settings
*   **Icon:** `settings-outline`

**Key UI Components (Sections):**

*   **Global Settings:**
    *   A list of toggle switches for the master controls.
    *   `Time-of-Day Scheduler Enabled:` [Toggle Switch] - Maps to `PUT /settings`.
    *   `Process Monitor Enabled:` [Toggle Switch] - Maps to `PUT /settings`.
*   **Process Monitor:**
    *   A list of all monitored processes fetched from `GET /processes`.
    *   Each item shows the process name and the profile it triggers.
    *   Includes "Edit" and "Delete" buttons (`PUT /processes/:id`, `DELETE /processes/:id`).
    *   An "Add New Process" form at the bottom (`POST /processes`).
*   **Time Gradients:**
    *   A list of all gradient periods from `GET /time-gradients`.
    *   Each item shows the start/end times and the start/end color swatches.
    *   Includes "Edit" and "Delete" buttons.
    *   An "Add New Gradient" form for creating new time periods.
*   **Notifications:** (Can also be a section here)
    *   A CRUD interface for managing notification types, similar to the Process Monitor section.

### **Tab 3: Playground / Raw Editor**

This is the power-user tool for live experimentation and creating new profiles. It allows for direct manipulation of the profile JSON and immediate feedback on the hardware.

*   **Title:** Playground
*   **Icon:** `flask-outline`

**Key UI Components:**

*   **Profile JSON Editor:**
    *   A large `textarea` or, ideally, an embedded code editor component (like Monaco Editor, which powers VS Code) for syntax highlighting and better editing.
    *   It will be pre-populated with a default, clean profile JSON structure on page load to serve as a template.

*   **"Load Active Profile" Button:**
    *   **Action:** When clicked, it makes a `GET` request to the **`/active-profile`** endpoint.
    *   **Logic:** Upon receiving the JSON response, it will format it (pretty-print) and populate the content of the Profile JSON Editor.
    *   **Use Case:** This is the primary mechanism for capturing the keyboard's current state to be inspected, modified, or saved.

*   **"Apply" Button:**
    *   **Action:** When clicked, it takes the raw JSON text from the editor.
    *   **Logic:** It sends this JSON in the body of a `POST` request to the **`/apply-profile-raw`** endpoint.
    *   **Use Case:** This allows for immediate, real-time testing of custom effects without needing to save them as a preset file first.

*   **"Save to File..." Button:**
    *   **Action:** Takes the current content of the Profile JSON Editor.
    *   **Logic:** It will trigger a browser file-save dialog, prompting the user for a filename (e.g., `my_new_effect.json`) and saving the JSON content to their local disk.
    *   **Use Case:** This allows users to save and share their custom--built profiles. These saved files can then be used by the `/apply-profile/file/:filename` endpoint.

### **(Wildcard) Tab 4: Logs / Diagnostics**

This tab provides a view into the system's live operations, which is invaluable for debugging and understanding the automation logic.

*   **Title:** Logs
*   **Icon:** `terminal-outline`
*   **Implementation:**
    *   The Express server can be configured to emit events via **WebSockets** (`socket.io`) whenever a significant action occurs (e.g., "Scheduler tick," "Process override activated," "Notification triggered").
    *   The "Logs" tab in the Ionic app would connect to this WebSocket and display a real-time, scrolling list of these log messages.
    *   **Content:**
        *   `[20:05:00] SCHEDULER: Time-of-day override active. Setting ambient color to #FF8C00.`
        *   `[20:06:15] PROCESS: Detected 'Destiny2.exe'. Activating process override.`
        *   `[20:06:16] API: Applying profile 'aurora_sync.json'.`
        *   `[20:10:00] API: Received POST /notify for type 'new_message'. Ignoring due to active process override.`

This architecture provides a clean separation between status (Dashboard), configuration (Settings), experimentation (Playground), and diagnostics (Logs), creating a powerful and intuitive user experience.